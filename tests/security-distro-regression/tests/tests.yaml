smoke_bundles:
  - keystone_v3_smoke_security: bionic-queens
  - keystone_v3_smoke_focal_security: focal-ussuri
  - keystone_v3_smoke_focal_security: jammy-yoga
  - keystone_v3_smoke_focal_security: lunar-antelope
  - keystone_v3_smoke_focal_security: mantic-bobcat
configure:
  - keystone_v3_smoke_security:
    - zaza.openstack.charm_tests.ceilometer.setup.basic_setup
    - zaza.openstack.charm_tests.glance.setup.add_lts_image
    - zaza.openstack.charm_tests.neutron.setup.basic_overcloud_network
    - zaza.openstack.charm_tests.nova.setup.create_flavors
    - zaza.openstack.charm_tests.nova.setup.manage_ssh_key
    - zaza.openstack.charm_tests.keystone.setup.add_demo_user
    - zaza.openstack.charm_tests.keystone.setup.add_tempest_roles
    - zaza.openstack.charm_tests.glance.setup.add_cirros_image
    - zaza.openstack.charm_tests.glance.setup.add_cirros_alt_image
  - keystone_v3_smoke_focal_security:
    - zaza.openstack.charm_tests.vault.setup.auto_initialize
    - zaza.openstack.charm_tests.ceilometer.setup.basic_setup
    - zaza.openstack.charm_tests.glance_simplestreams_sync.setup.sync_images
    - zaza.openstack.charm_tests.glance.setup.add_lts_image
    - zaza.openstack.charm_tests.octavia.setup.ensure_lts_images
    - zaza.openstack.charm_tests.octavia.diskimage_retrofit.setup.retrofit_amphora_image
    - zaza.openstack.charm_tests.octavia.setup.configure_octavia
    - zaza.openstack.charm_tests.neutron.setup.basic_overcloud_network
    - zaza.openstack.charm_tests.nova.setup.create_flavors
    - zaza.openstack.charm_tests.nova.setup.manage_ssh_key
    - zaza.openstack.charm_tests.keystone.setup.add_demo_user
    - zaza.openstack.charm_tests.keystone.setup.add_tempest_roles
    - zaza.openstack.charm_tests.glance.setup.add_cirros_image
    - zaza.openstack.charm_tests.glance.setup.add_cirros_alt_image
    - zaza.openstack.charm_tests.octavia.setup.centralized_fip_network
tests:
  - keystone_v3_smoke_security:
    - zaza.openstack.charm_tests.tempest.tests.TempestTestWithKeystoneV3
  - keystone_v3_smoke_focal_security:
    - zaza.openstack.charm_tests.tempest.tests.TempestTestWithKeystoneV3
tests_options:
  overlay_ppas:
    - ppa:ubuntu-security-proposed/ppa
  tempest:
    keystone_v3_smoke_security:
      smoke: True
    keystone_v3_smoke_focal_security:
      smoke: True
      include-list:
        - "manila_tempest_tests.tests.api.admin.test_admin_actions.AdminActionsTest.*"
        - "manila_tempest_tests.tests.api.admin.test_share_instances.ShareInstancesTest.*"
        - "manila_tempest_tests.tests.api.admin.test_share_snapshot_instances.ShareSnapshotInstancesTest.*"
        - "manila_tempest_tests.tests.api.admin.test_share_types.ShareTypesAdminTest.*"
        - "manila_tempest_tests.tests.api.admin.test_shares_actions.SharesActionsAdminTest.*"
      exclude-list:
        # Exclude the known failures due to issues with octavia/manila policy
        - "manila_tempest_tests.tests.api.admin.test_share_networks.ShareNetworkAdminTest"
        - "manila_tempest_tests.tests.api.test_share_networks.ShareNetworksTest"
        - "octavia_tempest_plugin.tests.scenario.v2.test_traffic_ops.TrafficOperationsScenarioTest"
  force_deploy:
    - lunar-antelope
    - mantic-bobcat
target_deploy_status:
  ceilometer:
    workload-status: blocked
    workload-status-message-prefix: "Run the ceilometer-upgrade action on the leader to initialize ceilometer and gnocchi"
  glance-simplestreams-sync:
    workload-status: unknown
    workload-status-message-prefix: ""
  mongodb:
    workload-status: unknown
    workload-status-message-prefix: ""
  neutron-api-plugin-ovn:
    workload-status: waiting
    workload-status-message-prefix: "'certificates' awaiting server certificate data, 'ovsdb-cms' incomplete"
  octavia:
    workload-status: blocked
    workload-status-message-prefix: Awaiting
  ovn-central:
    workload-status: waiting
    workload-status-message-prefix: "'ovsdb-peer' incomplete, 'certificates' awaiting server certificate data"
  ovn-chassis:
    workload-status: waiting
    workload-status-message-prefix: "'certificates' awaiting server certificate data"
  vault:
    workload-status: blocked
    workload-status-message-prefix: Vault needs to be initialized
